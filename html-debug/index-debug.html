<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title>xarta</title>
    <meta name="description" content="Xarta home">
    <meta name="author" content="Davros Xarta a.k.a David Bayliss">

    <meta name=viewport content="width=device-width, initial-scale=1">

    <!-- https://github.com/xarta/xarta -->
    <!-- (XARTA): INITIAL FILEs / INSPIRATION FROM: https://jsfiddle.net/k313cwtx/4/ -->

    <!-- NOT TESTED ON APPLE DEVICES AS I DON'T HAVE ANY !!! -->
    <!-- FOCUSSING ON CHROME/WINDOWS/ANDROID ... USING "preload" (nopush) 
    IN SERVER HEADER ... WILL LOOK AT FALL-BACKS FOR OTHER BROWSERS LATER -->

    <script>
        var timerStart = Date.now();    // will use later - e.g. decide on page load speed
                                        // - if quick enough, will load higher quality moon etc.
        //** ******************
        var xartaDebug = false;
        //** ******************
    </script>

    <!-- THIS PAGE DEPENDS ON THREE.JS - GET IT LOADING ASAP -->
    <link rel="preload" href="https://cdn.jsdelivr.net/threejs/0.85.2/three.min.js" as="script">

    <!-- concatenated / minified - see my repo for source -->
    <link rel="preload" href="js/homepage-min.js" as="script"> 

    <script async>
        var preloadWhoop = document.createElement("link");
        preloadWhoop.href = "/sound/whoop.mp3";
        preloadWhoop.rel = "preload";
        preloadWhoop.as = "audio";
    </script>


    <link rel="stylesheet" crossorigin href=
        "https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- chrome supports woff2 as well as preload ... using "type" 
    so won't download to browsers that don't support it -->
    <link rel="preload" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2?v=4.7.0" as="font" type="font/woff2" crossorigin>



    <link rel="stylesheet" href="css/styles.css?v=1.0">

    <!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->

    <!-- For IE 9 and below. ICO should be 32x32 pixels in size -->
    <!--[if IE]><link rel="shortcut icon" href="favicon-32x32.png"><![endif]-->

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">

</head>

    <body>
        <div id="container" class="no-js">
        <div id="blocker"></div> <!-- for three.js controls when using YouTube Iframes -->
                                 <!-- might not be using blocker now ... leaving for mo -->
        <div id="cameraPos"></div>



        <!-- <ul class="drawer">  --> <!-- TODO: Aria or similar roles / more semantic mark-up -->
            <!-- <li>Info <ul><li>1</li><li>2</li><li>3</li><ul> </li> </ul> etc. -->
        <ul id="navigation" class="drawer">
        <li id="li01" class="sticky has-hover">
            <a href="#?li01">
            <i class="fa fa-github"></i>
            <span>GitHub</span>
            </a>
            <ul>
            <li>
                <a href="https://github.com/xarta/borg-contact" target="_blank">
                <i class="fa fa-hand-spock-o"></i>
                <span>three.js overlay video</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/xarta/anxious-annie" target="_blank">
                <i class="fa fa-home"></i>
                <span>.Net IoT</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/xarta/xarta" target="_blank">
                <i class="fa fa-times"></i>
                <span>this</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/xarta/wp-syntaxhighlighter" target="_blank">
                <i class="fa fa-code"></i>
                <span>WP syntax highlight</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/xarta/wp-backup-bash" target="_blank">
                <i class="fa fa-wordpress"></i>
                <span>WP bash bkup</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/xarta/hmailserver-backup-scripts" target="_blank">
                <i class="fa fa-envelope-o"></i>
                <span>hMailSvr bkup</span>
                </a>
            </li>
            </ul>
        </li>
        <li id="li02" class="sticky has-hover">
            <a href="#?li02">
            <i class="fa fa-globe"></i>
            <span>Web</span>
            </a>
            <ul>
            <li>
                <a href="https://blog.xarta.co.uk/" target="_self">
                <i class="fa fa-wordpress"></i>
                <span>BLOG</span>
                </a>
            </li>
            <li>
                <a href="https://timeouttherapy.co.uk/" target="_blank">
                <i class="fa fa-leaf"></i>
                <span>timeouttherapy</span>
                </a>
            </li>
            <li>
                <a href="https://the-icons.co.uk/" target="_blank">
                <i class="fa fa-microphone"></i>
                <span>The Icons</span>
                </a>
            </li>
            </ul>
        </li>
        <li id="li03" class="sticky has-hover">
            <a href="#?li03">
            <i class="fa fa-info-circle"></i>
            <span>Dave</span>
            </a>
            <ul>
            <li>
                <a href="https://blog.xarta.co.uk/contact/" target="_self">
                <i class="fa fa-phone-square"></i>
                <span>Contact</span>
                </a>
            </li>
            <li> <!-- TODO: ADD NO-JS HREF AS FALLBACK (CAN CHANGE IN JS) -->
                <a id="YouTubeLink" href="#" target="_self">
                <i class="fa fa-video-camera"></i>
                <span>YouTube</span>
                </a>
            </li>
            <li>
                <a href="#" target="_blank">
                <i class="fa fa-question-circle"></i>
                <span>About</span>
                </a>
            </li>
            </ul>
        </li>
        </ul>

        <div id="orbitControls" style="display:none">
            <a id="orbClick" href="#" target="_self">
                <i class="fa fa-street-view"></i>
                <span>Controls</span>
            </a>
        </div>
        <div class="restart-page">
        
        <a href="javascript:history.go(0)" target="_self" title="Refresh">

            <svg onmouseenter= "el=this;el.classList.add('active');
                 setTimeout(function(){el.classList.remove('active')},600);
                 new Beep(22050).play(2000, 0.05, [Beep.utils.amplify(1000)]);"
                 xmlns="http://www.w3.org/2000/svg"  viewBox="-14 -14 80 80">

            <g class="refresh-holder">
                <path class="refresh" d=    
                    "M61.063-6.444c-3.155,3.74-6.231,7.583-9.375,11.339c-0.152,
                    0.217-0.328-0.028-0.449-0.149c-3.563-4.229-7.932-7.455-12.674-9.317
                    c-5.465-2.145-11.4-2.48-17.007-0.985C11.578-2.971,2.838,5.738-1.176,
                    17.122c0.005,0.002,0.009,0.004,0.014,0.007c-0.335,0.8-0.523,
                    1.704-0.523,2.662c0,3.258,2.177,5.898,4.86,5.898c2.302,0,4.228-1.939,
                    4.73-4.545c2.871-7.401,8.55-13.128,15.107-15.082c7.585-2.322,16.185,
                    0.234,21.71,7.062c-3.201,3.85-6.449,7.643-9.64,11.508c8.649-0.056,
                    17.301-0.024,25.952-0.016C61.109,14.264,61.057,3.909,61.063-6.444z"/>

                <path class="refresh" d=
                    "M46.139,30.043c-2.125,0-3.93,1.654-4.591,3.959c-0.001,
                    0-0.003-0.001-0.004-0.002C38.768,41.512,33.18,47.439,26.6,49.55c-7.673,
                    2.522-16.486,0.054-22.114-6.887c3.187-3.837,6.448-7.584,9.619-11.438
                    c-8.676,0.01-17.353,0.006-26.028,0.004c-0.02,10.332-0.021,20.664,
                    0.003,30.996c3.186-3.861,6.356-7.742,9.561-11.584c2.05,2.432,4.324,
                    4.598,6.818,6.324c7.953,5.639,17.932,6.809,26.637,3.154c8.352-3.402,
                    15.413-11.141,19.065-20.863C50.689,38.313,51,37.17,51,35.941C51,32.686,
                    48.822,30.043,46.139,30.043z"/>
            </g>
            <path class="x" d=
                "M13.34,38.108c0-0.568,1.728-3.423,3.84-6.342c2.112-2.92,4.147-5.755,4.523-6.3
                c0.376-0.546-0.015-3.711-0.867-7.033c-1.767-6.885-1.928-9.174-0.708-10.066c1.667-1.222,
                3.953,0.582,5.873,4.632l1.946,4.102l3.652-4.249c2.4-2.794,4.115-4.038,5.006-3.634c1.76,
                0.802,2.775,3.936,1.445,4.461c-1.51,0.597-7.762,11.873-7.748,13.979c0.004,0.998,0.893,
                3.646,1.973,5.884c0.762,1.578,1.785,2.824,1.379,3.681L31.482,41.8c-0.422,
                0.888-1.979-1.479-3.822-3.776l-3.216-4.009l-3.565,5.014c-1.961,2.757-3.792,4.998-4.068,
                4.981C16.533,43.992,13.34,38.677,13.34,38.108z"/>

            </svg>
        </a>
        </div> <!-- end of refresh-page discreet icon -->

        
        <div id="log" class = "debug" style="position: absolute; display: none;
                                z-index: 100; top: 5px; left: 20px; 
                                background-color: white; width: 50vw; height: 75vh;">
        </div>

        </div> <!-- end of container -->
        
    </body>

<footer>
    <script src="https://cdn.jsdelivr.net/threejs/0.85.2/three.min.js" defer></script>
    <script src="js/homepage-min.js" defer></script>  <!-- concatenated and minified -->

    <script>
        document.getElementById("container").classList.remove("no-js");

        window.onload = function(e)
        { 
            console.log("window.onload", e, Date.now());



        }

    </script>
    <div id="xarta-no-js">
        <style>
            /* TODO: @media for no-js, and more functionality */
            .no-js
            {
                background-image: url("https://res.cloudinary.com/xarta/image/upload/v1497039749/xarta/temp-background.jpg");
                background-repeat: no-repeat;
                background-size: cover;
            }
        </style>
    </div>
    <script>
        var element = document.getElementById("xarta-no-js");
        element.parentNode.removeChild(element);

        // do asap
        var navDrawer = document.getElementsByClassName("drawer")[0];
        var dimDrawer;
        navDrawer.style.opacity = 0.4;
        var NavHoverState = true; // will detect it for touch use

    </script>

    <script defer>
        function hasClass(el, className)
        {
            if (el.classList)
            {
                //console.log("hasClass(): el.classList");
                return el.classList.contains(className);
            }
            else
            {
                //console.log("hasClass(): new RegExp");
                return new RegExp('(^| )' + className + '( |$)', 'gi').test(el.className);
            }
        }



        // DEBUG - SHOW
        if (window.xartaDebug === true)
        {
            for (var i=0; i<document.getElementsByClassName("debug").length; i++)
            {
                document.getElementsByClassName("debug")[i].style.display = "block";
            }

            function log(msg) 
            {
                var p = document.getElementById('log');
                p.innerHTML = msg + "<br>" + p.innerHTML;
            }
        }
        else
        {
            function log(msg)
            {
                // do nothing
            }
        }


        // Audio mp3's (won't play on mobile wihtout touch-interaction, normally)
        var myAudio = document.createElement('audio');
        if (myAudio.canPlayType('audio/mpeg')) 
        {
            var whoop = document.createElement('audio');
            whoop.setAttribute('src','sound/whoop.mp3');
        }
        else
        {
            var fnName = "play";
            
            var whoop;
            whoop[play] = function() {console.log("Playing whoop sound")};

        }

        // https://github.com/luciferous/beepjs -------------------------------------------------------
        
        // only first note will play (as direct consequence of click/guester) on Android Chrome
        function play(keys) 
        {
            var key = keys.shift();
            if(typeof key == 'undefined') return; // song ended
            new Beep(22050).play(key[0], key[1], [Beep.utils.amplify(8000)], function() { play(keys); });
        }
        
        // ---------------------------------------------------------------------------------------------

        const TOUCHNOTLIKELY = false;
        const TOUCHLIKELY = true;
        var usingTouchDevice = TOUCHNOTLIKELY;

        const YOUTUBEINFRONT = -1; // WebGL z-index ... -1 puts it behind CSS3D render for YouTube
        const YOUTUBEBEHIND = 11;
        const YOUTUBECLICKED = true;
        const YOUTUBENOTCLICKED = false;
        var YouTubeClickedYet =YOUTUBENOTCLICKED;
        var YouTubeDefault =YOUTUBEBEHIND;  // change if touch detected else tricky to control
                                            // TODO: custom gui controls for YouTube

        navDrawer.addEventListener('mouseover', function(e){
            window.navDrawer.style.opacity = 1.0;
            rendererGL.domElement.style.zIndex = YOUTUBEINFRONT;
            window.calmCylinders = true;        // used in scene.js minified to homepage.js
            if ( !(typeof window.moonMesh === 'undefined' || window.moonMesh === null) ) 
            {
                window.moonMesh.material.color.setHex( 0xff0000 );
            }
            clearTimeout(dimDrawer);
            dimDrawer = setTimeout(function() {
                rendererGL.domElement.style.zIndex = YouTubeDefault;
                window.navDrawer.style.opacity = 0.3;
                window.calmCylinders = false;   // used in scene.js minified to homepage.js
                if ( !(typeof window.moonMesh === 'undefined' || window.moonMesh === null) ) 
                {
                    window.moonMesh.material.color.setHex( 0xffffff );
                }
                if (window.controls !== null)
                {
                    setTimeout(function() 
                    {
                        document.getElementById('controlsFocus').focus();

                        var path = window.location.pathname;
                        var page = path.split("/").pop();

                        if (!(page === "index-d.html"))
                        {
                            document.getElementById("cameraPos").style.display="block";
                            setTimeout(function() 
                            {
                                document.getElementById('controlsFocus').focus();
                                setTimeout(function() {
                                    document.getElementById("cameraPos").style.display="none";
                                }, 50);
                            }, 20);  
                        }
                        console.log("focusing on element to get OrbitControls back");
                    }, 20);
                }
            }, 3000);
        }, false);

        navDrawer.addEventListener('touchstart', function(e){
            usingTouchDevice = TOUCHLIKELY;
            YouTubeDefault = YOUTUBEINFRONT;
            window.calmCylinders = true;        // used in scene.js minified to homepage.js
            window.navDrawer.style.opacity = 1.0;
            rendererGL.domElement.style.zIndex = YOUTUBEINFRONT;
            clearTimeout(dimDrawer);
            dimDrawer = setTimeout(function() 
            {
                window.navDrawer.style.opacity = 0.2;
                window.calmCylinders = false;   // used in scene.js minified to homepage.js
                rendererGL.domElement.style.zIndex = YouTubeDefault;

                if (window.controls !== null)
                {
                    setTimeout(function() 
                    {
                        document.getElementById('controlsFocus').focus();

                        var path = window.location.pathname;
                        var page = path.split("/").pop();

                        if (!(page === "index-d.html"))
                        {
                            document.getElementById("cameraPos").style.display="block";
                            setTimeout(function() 
                            {
                                document.getElementById('controlsFocus').focus();
                                setTimeout(function() {
                                    document.getElementById("cameraPos").style.display="none";
                                }, 50);
                            }, 20);  
                        }
                        console.log("focusing on element to get OrbitControls back");
                    }, 20);
                }
            }, 3000);
        }, false);

        navDrawer.addEventListener('click', function(e){

            // true by default, changed by touchstart events only
            if(window.NavHoverState === true)
            {
                new Beep(22050).play(2000, 0.05, [Beep.utils.amplify(1000)]);
            }
            else
            {
                if ( !(typeof window.moonMesh === 'undefined' || window.moonMesh === null) ) 
                {
                    window.moonMesh.material.color.setHex( 0xffffff );
                }
                new Beep(22050).play(500, 0.05, [Beep.utils.amplify(1000)]);
            }

            
        }, false);

        // controls clickable activation link at bottom of screen
        document.getElementById("orbitControls").style.display="block";
        var orbClick =document.getElementById("orbClick");
        orbClick.onmouseover = function()
        {
            new Beep(22050).play(2000, 0.05, [Beep.utils.amplify(1000)]);
        };
        orbClick.onclick = loadOrbitControls;

        function loadOrbitControls() {
            console.log("enter loadOrbitControls");
            if (typeof window.controls === 'undefined' || window.controls === null ) 
                {
                    console.log("controls are undefinied or null - so will download script and create");
                    var script = document.createElement("script");
                    script.src = 'js/OrbitControls-min.js';

                    play([[392, 0.2], [440, 0.3], [349, 0.2], [175, 0.3], [262, 1]]);

                    document.getElementsByTagName('head')[0].appendChild(script);
                    
                    script.onload = function()
                    {
                        
                        console.log("OrbitControls-min.js loaded");
                        window.controls = new THREE.OrbitControls(camera, rendererGL.domElement);
                    };

                    var path = window.location.pathname;
                    var page = path.split("/").pop();
                    //console.log( page );
                    if (page === "index-d.html")
                    {
                        document.getElementById("cameraPos").style.display="block";  
                    }
                    
                    // don't want to press the button again
                    document.getElementById("orbitControls").style.display="none";
                }
                else
                {
                    console.log("Apparently controls already exist");
                    
                    //window.controls.dispose();
                    if(YouTubeDefault == YOUTUBEINFRONT)
                    {
                        console.log("window.controls.enabled=false");
                        window.controls.enabled=false;
                    }
                    else
                    {
                        console.log("window.controls.enabled=true");
                        window.controls.enabled=true;
                    }

                }
            return false;
        }


        var YouTubeLink = document.getElementById("YouTubeLink");

        YouTubeLink.addEventListener('touchstart', function(e){
            document.getElementById("li03").classList.toggle("has-hover");
        }, false);

        YouTubeLink.onclick = function(){
            // toggle z-index of CSS3D renderer (with YouTube)
            // to make controls accssible
            if(YouTubeClickedYet == YOUTUBECLICKED)
            {
                controls.saveState();
                if(usingTouchDevice == TOUCHNOTLIKELY)
                {
                    if(YouTubeDefault == YOUTUBEBEHIND)
                    {
                        YouTubeDefault = YOUTUBEINFRONT;
                    }
                    else
                    {
                        YouTubeDefault = YOUTUBEBEHIND;
                    }
                }
                else
                {
                    screenFullSize("s1"); // ASSUMPTION - SMALL SCREEN IS TOUCH DEVICE - JUST ONE EMBED
                }

            }
            YouTubeClickedYet = YOUTUBECLICKED;
            loadOrbitControls();    // also toggles enabled if already loaded, depending on z-index
            YouTubeVidWall();       // will only add the videos once
            return false;
        };

        // experimenting with touch, for cancelling sticky flyout menu on repeated-tap
        // THIS IS DEPENDENT ON HACKY-WAY OF USING KNOWN INFORMATION ON OPACITY STATE
        var topListButton;
        for (var i=0; i<document.getElementsByClassName("sticky").length; i++)
        {
            topListButton = document.getElementsByClassName("sticky")[i].id;
            /*
            log("Adding event listener for " + topListButton);
            log("children length: " + document.getElementsByClassName("sticky")[i].children.length);

            for (var k=0; k<document.getElementById(topListButton).children.length; k++)
            {
                log(k + ": " + document.getElementById(topListButton).children[k].innerHTML);
            }
            */

            (function(topListButton) {
                
                // children[0] should be the <a> href link ... using that for touch detect
                document.getElementById(topListButton).children[0].addEventListener('touchstart', function(e){
                    var touchlist = e.touches;
                    //log(topListButton);
                    var alreadySelected = (window.getComputedStyle(document.getElementById(topListButton)).opacity > 0.9);

                    window.navDrawer.style.opacity = 1.0;

                    //log(topListButton + ": " + alreadySelected);

                    if (alreadySelected)
                    {
                        document.getElementById(topListButton).classList.toggle("has-hover");
                    }
                    else
                    {
                        document.getElementById(topListButton).classList.add("has-hover");
                    }

                    if (hasClass( document.getElementById(topListButton), "has-hover"))
                    {
                        window.NavHoverState = true;
                        //console.log("window.NavHOverState = true");
                    }
                    else
                    {
                        window.NavHoverState = false;
                        //console.log("window.NavHOverState = false");
                    }
                    
                }, false);
            })(topListButton);
        }

        
    </script>

</footer>

</html>




